{"version":3,"sources":["../../src/middlewares/authenticationMiddleware.js"],"names":["req","res","next","token","headers","authorization","removeBearerFromString","jwt","verify","signingSecret","catch","status","message","decoded","userModel","findOne","username","user","locals","bearerReg","RegExp","test","replace"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;;0BAEe,iBAAOA,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEHC,YAAAA,KAFG,GAEKH,GAAG,CAACI,OAAJ,CAAYC,aAFjB;;AAAA,iBAGHF,KAHG;AAAA;AAAA;AAAA;;AAIHA,YAAAA,KAAK,GAAGG,sBAAsB,CAACH,KAAD,CAA9B;AAJG;AAAA,mBAMiBI,iBAAIC,MAAJ,CAAWL,KAAX,EAAkBM,qBAAlB,EAAiCC,KAAjC,CAAuC,YAAM;AAC7D,oBAAM;AAAEC,gBAAAA,MAAM,EAAE,GAAV;AAAeC,gBAAAA,OAAO,EAAE;AAAxB,eAAN;AACH,aAFmB,CANjB;;AAAA;AAMCC,YAAAA,OAND;AAAA;AAAA,mBAUcC,gBAAUC,OAAV,CAAkB;AAAEC,cAAAA,QAAQ,EAAEH,OAAO,CAACG;AAApB,aAAlB,CAVd;;AAAA;AAUCC,YAAAA,IAVD;;AAAA,gBAYEA,IAZF;AAAA;AAAA;AAAA;;AAAA,kBAYc;AAAEN,cAAAA,MAAM,EAAE,GAAV;AAAeC,cAAAA,OAAO,EAAE;AAAxB,aAZd;;AAAA;AAcHX,YAAAA,GAAG,CAACiB,MAAJ,CAAWD,IAAX,GAAkBA,IAAlB;AAdG,6CAeIf,IAAI,EAfR;;AAAA;AAAA,kBAiBG;AAAES,cAAAA,MAAM,EAAE,GAAV;AAAeC,cAAAA,OAAO,EAAE;AAAxB,aAjBH;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,6CAoBAV,IAAI,aApBJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;;;;;;AAwBf,IAAMI,sBAAsB,GAAG,SAAzBA,sBAAyB,CAAAH,KAAK,EAAI;AACpC,MAAIgB,SAAS,GAAG,IAAIC,MAAJ,CAAW,eAAX,CAAhB;;AACA,MAAID,SAAS,CAACE,IAAV,CAAelB,KAAf,CAAJ,EAA2B;AACvB,WAAOA,KAAK,CAACmB,OAAN,CAAcH,SAAd,EAAyB,EAAzB,CAAP;AACH,GAFD,MAEO;AACH,WAAOhB,KAAP;AACH;AACJ,CAPD","sourcesContent":["import jwt from 'jwt-then';\r\nimport { signingSecret } from '../config';\r\nimport {userModel} from '../model/user';\r\n\r\nexport default async (req, res, next) => {\r\n    try {\r\n        let token = req.headers.authorization;\r\n        if (token) {\r\n            token = removeBearerFromString(token);\r\n\r\n            let decoded = await jwt.verify(token, signingSecret).catch(() => {\r\n                throw { status: 401, message: 'invalid token' };\r\n            });\r\n\r\n            let user = await userModel.findOne({ username: decoded.username });\r\n\r\n            if (!user) throw { status: 401, message: 'Unauthorized user' };\r\n\r\n            res.locals.user = user;\r\n            return next();\r\n        } else {\r\n            throw { status: 401, message: 'invalid token' };\r\n        }\r\n    } catch (error) {\r\n        return next(error);\r\n    }\r\n};\r\n\r\nconst removeBearerFromString = token => {\r\n    let bearerReg = new RegExp('[b|B]earer\\\\s');\r\n    if (bearerReg.test(token)) {\r\n        return token.replace(bearerReg, '');\r\n    } else {\r\n        return token;\r\n    }\r\n};\r\n"],"file":"authenticationMiddleware.js"}