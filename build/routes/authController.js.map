{"version":3,"sources":["../../src/routes/authController.js"],"names":["router","post","req","res","next","body","userModel","findOne","username","loginUser","status","message","comparePassword","password","jwt","sign","signingSecret","token","json","bearer","user","checkUser","isPasswordValid","newUser","hashPassword","save","_id"],"mappings":"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","sourcesContent":["import { Router } from 'express';\r\nimport parameterMiddleware from '../middlewares/parameterMiddleware';\r\nimport { userModel } from '../model/user';\r\nimport jwt from 'jwt-then';\r\nimport { signingSecret } from '../config';\r\n\r\nconst router = Router();\r\n\r\nrouter.post(\r\n    '/login',\r\n    parameterMiddleware(['username', 'password']),\r\n    async (req, res, next) => {\r\n        try {\r\n            let { body } = req;\r\n            let loginUser = await userModel.findOne({\r\n                username: body.username\r\n            });\r\n\r\n            if (!loginUser)\r\n                throw {\r\n                    status: 401,\r\n                    message: 'Username or Password Incorrect'\r\n                };\r\n                \r\n            if (!(await loginUser.comparePassword(body.password)))\r\n                throw {\r\n                    status: 401,\r\n                    message: 'Username or Password Incorrect'\r\n                };\r\n\r\n            let token = await jwt.sign(\r\n                { username: loginUser.username },\r\n                signingSecret\r\n            );\r\n\r\n            return res\r\n                .status(200)\r\n                .json({ bearer: token, user: loginUser.username });\r\n        } catch (ex) {\r\n            next(ex);\r\n        }\r\n    }\r\n);\r\n\r\nrouter.post(\r\n    '/register',\r\n    parameterMiddleware(['username', 'password']),\r\n    async (req, res, next) => {\r\n        try {\r\n            let { body } = req;\r\n\r\n            let checkUser = await userModel.findOne({\r\n                username: body.username\r\n            });\r\n\r\n            if (checkUser)\r\n                throw { status: 400, message: 'Username already exists' };\r\n\r\n            if (userModel.isPasswordValid(body.password))\r\n                throw {\r\n                    status: 400,\r\n                    message: 'Password does not meet the requirements'\r\n                };\r\n            let newUser = new userModel({\r\n                username: body.username\r\n            });\r\n\r\n            await newUser.hashPassword(body.password);\r\n\r\n            await newUser.save();\r\n            return res\r\n                .status(201)\r\n                .json({ username: newUser.username, _id: newUser._id });\r\n        } catch (ex) {\r\n            next(ex);\r\n        }\r\n    }\r\n);\r\n\r\nexport default router;\r\n"],"file":"authController.js"}